<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Endpoint Tester</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        h1 { color: #569cd6; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: #252526; border-radius: 8px; padding: 15px; }
        label { display: block; margin-bottom: 5px; color: #9cdcfe; font-weight: 500; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #3c3c3c; border-radius: 4px; background: #1e1e1e; color: #d4d4d4; font-family: 'Consolas', monospace; }
        textarea { min-height: 200px; resize: vertical; }
        button { background: #0e639c; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background: #1177bb; }
        button:disabled { background: #3c3c3c; cursor: not-allowed; }
        .response { background: #1e1e1e; border: 1px solid #3c3c3c; border-radius: 4px; padding: 15px; min-height: 200px; overflow: auto; white-space: pre-wrap; font-family: 'Consolas', monospace; font-size: 13px; }
        .success { border-color: #4ec9b0; }
        .error { border-color: #f14c4c; }
        .status { margin-bottom: 10px; padding: 8px; border-radius: 4px; }
        .status.success { background: #2d4a3e; color: #4ec9b0; }
        .status.error { background: #4a2d2d; color: #f14c4c; }
    </style>
</head>
<body>
    <h1>GraphQL Endpoint Tester</h1>

    <div class="panel" style="margin-bottom: 20px;">
        <label for="endpoint">Endpoint URL</label>
        <input type="text" id="endpoint" value="https://dataos.naea1.uds-dev.lenovo.com/lens2/api/public:udc-sm/v2/graphql">

        <label for="token" style="margin-top: 15px;">Authorization Token</label>
        <input type="text" id="token" value="bWFpblQuMTkwNjkzYjUtZmEyYy00YzA5LWJhMjItYWM2OGM0YmZhODQz">
    </div>

    <div class="container">
        <div class="panel">
            <label for="query">GraphQL Query</label>
            <textarea id="query">query LensQuery {
  table(offset: 0, timezone: "UTC", orderBy: {}) {
    udc_smart_messages {
      msg_category
      msg_display
      number_of_messages_sent
      displayed
      clicked
      engagement_rate
    }
  }
}</textarea>

            <label for="variables" style="margin-top: 15px;">Variables (JSON)</label>
            <textarea id="variables" style="min-height: 80px;">{}</textarea>

            <button onclick="runQuery()" id="runBtn">Run Query</button>
        </div>

        <div class="panel">
            <label>Response</label>
            <div id="status" class="status" style="display: none;"></div>
            <div id="response" class="response">Click "Run Query" to test the endpoint</div>
        </div>
    </div>

    <script>
        async function runQuery() {
            const endpoint = document.getElementById('endpoint').value;
            const token = document.getElementById('token').value;
            const query = document.getElementById('query').value;
            const variablesText = document.getElementById('variables').value;
            const responseEl = document.getElementById('response');
            const statusEl = document.getElementById('status');
            const runBtn = document.getElementById('runBtn');

            let variables = {};
            try {
                variables = JSON.parse(variablesText);
            } catch (e) {
                statusEl.style.display = 'block';
                statusEl.className = 'status error';
                statusEl.textContent = 'Invalid JSON in variables';
                return;
            }

            runBtn.disabled = true;
            runBtn.textContent = 'Loading...';
            responseEl.textContent = 'Sending request...';
            responseEl.className = 'response';

            try {
                const startTime = Date.now();
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ query, variables })
                });

                const elapsed = Date.now() - startTime;
                const data = await res.json();

                statusEl.style.display = 'block';
                if (res.ok && !data.errors) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `✓ ${res.status} ${res.statusText} (${elapsed}ms)`;
                    responseEl.className = 'response success';
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = `✗ ${res.status} ${res.statusText} (${elapsed}ms)`;
                    responseEl.className = 'response error';
                }

                responseEl.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                statusEl.style.display = 'block';
                statusEl.className = 'status error';
                statusEl.textContent = '✗ Request failed';
                responseEl.className = 'response error';
                responseEl.textContent = err.message;
            } finally {
                runBtn.disabled = false;
                runBtn.textContent = 'Run Query';
            }
        }
    </script>
</body>
</html>
